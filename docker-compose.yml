version: '3.8'

services:
  # Python Backend - The Brain
  backend:
    build:
      context: ./backend
      args:
        # Pass host user ID to prevent permission issues
        - UID=${UID:-1000}
        - GID=${GID:-1000}
    image: code-refiner-backend
    ports:
      - "8000:8000"
    volumes:
      # Mount the project directory you want to refactor
      - ./:/workspace
    env_file:
      - .env
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - FIRECRAWL_API_URL=http://firecrawl:3002
    depends_on:
      - firecrawl

  # Self-Hosted Research Agent
  firecrawl:
    image: firecrawl/firecrawl:latest
    ports:
      - "3002:3002"
    environment:
      - PORT=3002
    # Note: Firecrawl self-hosting often requires Redis/Playwright
    # This is the minimal service definition for the architecture.